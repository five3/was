function inject(){	if($('#container_dd').size() == 0&&flag == undefined)	{ 		var resource_URL = chrome.extension.getURL("inject.html");		var resource_Image = chrome.extension.getURL("initial.gif");		var resource_Image_1 = chrome.extension.getURL("operate.gif");		var inject_content = '<div class="container_dd" id="container_dd">\								  <div class="iframe_plug" id="menu">\										<div style="float:left; padding:0 5px;">\										<a id="inject_action" href="javascript:void(0);">Start Inpect</a>\										</div><div style="float:right; padding:0 10px;">\										<a id="plug_close" href="javascript:void(0);" >Close</a>\										</div>\								  </div>\							  	  <div id="show_attr" class="show_attr_css">\									<table class="inject_table" id="inject_table" border="0" cellpadding="2" cellspacing="2">\										<tr class="headline">\											<td class="c10" style="width:30">Attribute</td>\											<td class="c10" style="width:50">Value</td>\											<td class="c10" style="width:20">Operate</td>\										</tr>\										<tr>\											<td class="c10"><label>ID:</label></td>\											<td class="c10"><input type="text" id="element_id"></td>\											<td class="c10"><a id="element_id_add" class="add_attribute" href="javascript:void(0);">&nbsp&nbsp&nbsp&nbsp</a></td>\										</tr>\										<tr>\											<td class="c10"><label>Name:</label></td>\											<td class="c10"><input type="text" id="element_name"></td>\											<td class="c10"><a  id="element_name_add" class="add_attribute" href="javascript:void(0);">&nbsp&nbsp&nbsp&nbsp</a></td>\										</tr>\										<tr>\											<td class="c10"><label>ClassName:</label></td>\											<td class="c10"><input type="text" id="element_classname"" ></td>\											<td class="c10"><a  id="element_classname_add" class="add_attribute" href="javascript:void(0);">&nbsp&nbsp&nbsp&nbsp</a></td>\										</tr>\										<tr>\											<td class="c10"><label>Text:</label></td>\											<td class="c10"><input type="text" id="element_text"" ></td>\											<td class="c10"><a  id="element_text_add" class="add_attribute" href="javascript:void(0);">&nbsp&nbsp&nbsp&nbsp</a></td>\										</tr>\										<tr>\											<td class="c10"><label>Value:</label></td>\											<td class="c10"><input type="text" id="element_value"" ></td>\											<td class="c10"><a  id="element_value_add" class="add_attribute" href="javascript:void(0);">&nbsp&nbsp&nbsp&nbsp</a></td>\										</tr>\										<tr style="display:none">\											<td class="c10"><label>Link Text:</label></td>\											<td class="c10"><input type="text" id="element_link_text"></td>\											<td class="c10"><a id="element_link_text_add" class="add_attribute" href="javascript:void(0);">&nbsp&nbsp&nbsp&nbsp</a></td>\									  	</tr>\									  </table>\								   </div>\									<div id="select_attr" class="select_attr_css">\										<table id="select_table" class="select_table" border="0">\											<tr class="headline">\												<td class="c10">Attribute</td>\												<td class="c10">Value</td>\												<td class="c10">Operate</td>\											</tr>\										</table>\									</div>\								<div class="operate_area" id="operate_area">\										<div class="content" align="left">\											<label>User Define:</label>\											<p>\												<input id="customer_type" value="---Select---" class="ddap_cust_type" />\												<select id="customer_type_selector">\													<option value="---Select---">---Select---</option>\													<option value="index">index</option>\													<option value="xpath">xpath</option>\													<option value="css_selector">css selector</option>\												</select>\												<input type="text" maxlength="80" size="50" id="customer_value">\												<a class="link" href="javascript:void(0)" id="customer_define_type">add</a>\											</p>\											<hr></hr>\										</div>\										<div class="content" align="left">\											<label>User Action:</label>\											<p>\												<label>Name:</label>\												<input id="hightlight" type="text" maxlength="80" size="40">\												<a class="link">Load</a>\												<a class="link">hightlight</a>\											</p>\											<hr></hr>\										</div>\										<div class="content" align="left">\											<label>Element Save:</label>\											<p>\												<label>Project:</label>\												<select id="element_attribut_project">\													<option value="0">---Select---</option>\												</select>\												<label>Page:</label>\												<select id="element_attribut_page">\													<option value="0">---Select---</option>\												</select>\											</p>\										</div>\										<div class="content" align="left">\											<p>\												<label>Parent:</label>\												<select id="element_attribut_parent">\													<option value="0">---Select---</option>\												</select>\												<label>ElementType:</label>\												<input type="text" id="element_type">\												<input type="hidden" id="element_tagname">\											</p>\										</div>\										<div class="content" align="left">\											<p>\												<label>Name:</label>\												<input type="text" maxlength="80" size="50" id="element_attribut_name">\											</p>\										</div>\										<div class="content" align="left">\											<p>\												<label>memo:</label>\												<input type="text" maxlength="80" size="50" id="element_attribut_memo">\												<a id="element_attribut_save" class="save link">save</a>\											</p>\										</div>\									</div>\							  </div>';			$('html').append(inject_content);		$('#show_attr').find('a').css('background','url('+resource_Image_1+') no-repeat scroll -4px -4px transparent');		$("#inject_action").click(inject_div);		$("#plug_close").click(function(){$("#container_dd").hide(); flag = 0;});		$("#customer_define_type").click(add_attribute);		add_data("http://qa.dangdang.com/ddap_platform/project_listProject","element_attribut_project");		$('#element_attribut_project').bind("change",get_page);		$("#element_attribut_save").click(element_attribut_save);		$('#customer_type_selector').bind("change",update_element_type);		add_click();		flag=1;	}else if(flag == 0&&$('#container_dd').size() == 1){		$('#container_dd').show();		flag = 1;	}else{		$('#container_dd').hide();		flag = 0;	}}var last_elem, last_elem_style,div_inject_action;var flag,statue;var i = 1; inject();function inject_div(){	$("#show_attr").find('tr').show();	$("#select_table tr:not(:first)").empty();	if ($('#inject_action').text() == 'Stop Inpect'){		$('#inject_action').text('Start Inpect');		$('#cover_div').remove();		if (last_elem != undefined){					last_elem.style.border = last_elem_style;		}		$('#container_dd').css('height',div_inject_action);	}else if($('#inject_action').text() == 'Start Inpect'){		div_inject_action = $('#container_dd').height();		$('#container_dd').css('height',"20px");		var cover_div = '<div id="cover_div" style="margin: 0px; padding: 0px; border: 0px; position: absolute; overflow: hidden; display: block; z-index: 2147483551; top: 0px; left: 0px; background-image: url(http://getfirebug.com/releases/lite/skin/xp/pixel_transparent.gif); width: 100%; background-position: initial initial; background-repeat: initial initial;"></div>';		if($('#cover_div').size()==0)		{			$('body').append(cover_div);		}		else		{			$('#cover_div').show();		}		$('#cover_div').css('height', document.body.clientHeight);		$('#cover_div').bind("click",onInspecting);		$('#cover_div').bind("mousemove",onInspectingover);		$('#inject_action').text('Stop Inpect');			}}function onInspecting(e){	$('#cover_div').hide();	$('#element_link_text').parent().parent().hide();	var targ = getElementFromPoint(e.clientX, e.clientY);	$('#cover_div').show();	$('#container_dd').css('height',div_inject_action);	$('#element_id').val(targ.id);	$('#element_name').val(targ.name);	$('#element_classname').val(targ.className);		$('#element_text').val(targ.innerText);	$('#element_value').val(targ.value);	$('#element_tagname').val(targ.tagName);	if(targ.tagName=="INPUT"){		$('#element_type').val(targ.type);	}else if(targ.tagName=="A"){		$('#element_link_text').val(targ.text);		$('#element_link_text').parent().parent().show();				$('#element_type').val(targ.tagName);	}else{		$('#element_type').val(targ.tagName);	}	removeElement();	$('#inject_action').text('Start Inpect');}function onInspectingover(e){	if (last_elem != undefined){				last_elem.style.border = last_elem_style;	}	$('#cover_div').hide();		var targ = getElementFromPoint(e.clientX, e.clientY);	last_elem = targ;	last_elem_style = targ.style.border;	$('#cover_div').show();	targ.style.border = 'thin inset blue';}	function getElementFromPoint(x, y){	if (false)	{		var scroll = this.getWindowScrollPosition();		return this.document.elementFromPoint(x + scroll.left, y + scroll.top);	}	else		return this.document.elementFromPoint(x, y);}function removeElement(){	$('#cover_div').hide();	last_elem.style.border = last_elem_style;	$('#cover_div').unbind("click",onInspecting);	$('#cover_div').unbind("mousemove",onInspectingover);	$('#inject_action').text('Start Inpect');}function add_click(){	$("#show_attr").find("a").each(function(){		$(this).click(add_attribute)	});}function add_attribute(){	switch($(this).attr("id"))	{		case 'element_id_add':			if($("#element_id").val()=="")			{				alert("the Attribute is null!")				return			}			select_attribute($("#element_id").val(),"ID");			$(this).parent().parent('tr').hide();		break;		case 'element_name_add':			if($("#element_name").val()=="")			{				alert("the Attribute is null!")				return			}			select_attribute($("#element_name").val(),"Name");			$(this).parent().parent('tr').hide();		break;		case 'element_classname_add':			if($("#element_classname").val()=="")			{				alert("the Attribute is null!")				return			}			select_attribute($("#element_classname").val(),"ClassName");			$(this).parent().parent('tr').hide();		break;		case 'element_text_add':			if($("#element_text").val()=="")			{				alert("the Attribute is null!")				return			}			select_attribute($("#element_text").val(),"Text");			$(this).parent().parent('tr').hide();		break;		case 'element_value_add':			if($("#element_value").val()=="")			{				alert("the Attribute is null!")				return			}			select_attribute($("#element_value").val(),"Value");			$(this).parent().parent('tr').hide();		break;				case 'element_link_text_add':			if($("#element_link_text").val=="")			{				alert("the Attribute is null!")				return			}			select_attribute($("#element_link_text").val(),"Link_Text");			$(this).parent().parent('tr').hide();		break;		case 'customer_define_type':			var customer_type = $("#customer_type").val().trim();			if(customer_type=="---Select---")			{				alert("no user define type selected!");				return;			}else if (customer_type==""){				alert("user define type can NOT Empty!");				return;							}			select_attribute($("#customer_value").val(),$("#customer_type").val());		break;	}}function select_attribute(text,id){	var resource_Image_2 = chrome.extension.getURL("operate_1.gif");	var tr='<tr>\			<td class="c10"><label>'+id+'</label></td>\			<td class="c10"><input type="text" id="select_attr_'+id+'" disabled="disabled" value="'+text+'"></td>\			<td class="c10"><a  id="element_'+id+'_delete" class="add_attribute" href="javascript:void(0);">&nbsp&nbsp&nbsp&nbsp</a></td>\			</tr>';	$("#select_table").append(tr);	$("#element_"+id+"_delete").css('background','url('+resource_Image_2+') no-repeat scroll -4px -4px transparent');	$("#element_"+id+"_delete").click(delete_attribute);}function delete_attribute(){	switch($(this).attr("id"))	{		case 'element_ID_delete':			$('#element_id_add').parent().parent('tr').show();		break;		case 'element_Name_delete':			$('#element_name_add').parent().parent('tr').show();		break;		case 'element_ClassName_delete':			$('#element_classname_add').parent().parent('tr').show();		break;		case 'element_Text_delete':			$('#element_text_add').parent().parent('tr').show();		break;		case 'element_Value_delete':			$('#element_value_add').parent().parent('tr').show();		break;				case 'element_Link_Text_delete':			$('#element_link_text').parent().parent('tr').show();		break;	}	$(this).parent().parent('tr').remove();}function element_attribut_save(){	if($("#element_attribut_project").val()=="0")	{		alert("please select Project!");		return;	}	if($("#element_attribut_page").val()=="0")	{		alert("please select Page!");		return;	}	if($("#element_attribut_name").val()=="")	{		alert("please enter element name!");		return;	}	if($("#element_attribut_memo").val()=="")	{		alert("please enter element memo!");		return;	}	if($("#select_table").find("input").length==0)	{		alert("please select element attribute!");		return;	}	var json={element:[	    	]};	var data = new Object();	var attribute = new Object();	$("#select_table").find("input").each(function(){		switch($(this).attr("id"))		{					case "select_attr_ClassName":				attribute.class_name = encodeURI($(this).val())			break			case "select_attr_Link_Text":				attribute.link_text = encodeURI($(this).val())			break			case "select_attr_css_selector":				attribute.css_selector = $(this).val()			break			default:				var attributes = $(this).attr("id").split("_");				var attr_type = attributes[attributes.length-1];				var eval_str = 'attribute.'+attr_type.toLowerCase()+'="'+$(this).val()+'"';				eval(eval_str);		}	});	attribute.tag_name=$("#element_tagname").val();	json.element.push(attribute);	data.project = $("#element_attribut_project").val();	data.page = $("#element_attribut_page").val();	data.element_name = encodeURI($("#element_attribut_name").val());	data.memo = encodeURI($("#element_attribut_memo").val());	data.element_type = $("#element_type").val();	if($("#element_attribut_parent").val()!="0")	{		data.parent = $("#element_attribut_parent").val();	}	json.element.push(data);	send_element(json);}function send_element(json){	if(window.XMLHttpRequest)  	{  		req=new XMLHttpRequest();  	}else if(window.ActiveXObject)  	{  		req=new ActiveXObject("Microsoft.XMLHTTP");  	}  	if(req)  	{  		req.open("post","http://qa.dangdang.com/ddap_platform/element_save",true);  		req.onreadystatechange=function(){  			if (req.readyState==4 && req.status==200)			{				attend(req.responseText);			}  		};  		req.send(JSON.stringify(json));  	}}function attend(responseText){	alert(responseText);}function add_data(url,name){	if(window.XMLHttpRequest)	{		req=new XMLHttpRequest();	}else if(window.ActiveXObject)	{		req=new ActiveXObject("Microsoft.XMLHTTP");	}if(req)	{		req.open("post",url,true);		req.onreadystatechange=function(){add_information(name);};		req.send(null);	}}function add_information(e){	if(req.readyState==4)	{		if(req.status==200)		{			$("#"+e).empty();			$("#"+e).append('<option value="0">---Select---</option>');			var json = eval(req.responseText);			for (var i=0;i<json.length;i++)			{				$("#"+e).append('<option value="'+json[i].id+'">'+json[i].name+'</option>');			}				}		else		{			alert("Not able to retrieve description"+req.statusText);		}	}}function get_page(){	var value = $('#element_attribut_project').val();	if(value == "0")	{		return;	}	add_data("http://qa.dangdang.com/ddap_platform/project_getProjectPageWithElements?id="+value,"element_attribut_page");	$('#element_attribut_page').bind("change",get_element);}function get_element(){	var value = $('#element_attribut_page').val();	if(value == "0")	{		return;	}	add_data("http://qa.dangdang.com/ddap_platform/element_getPageElement?page_id="+value,"element_attribut_parent");}function update_element_type(){	$('#customer_type').val(this.value);}